<!DOCTYPE html><html><head>
      <title>Introduccion</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:////home/nico/.vscode/extensions/shd101wyy.markdown-preview-enhanced-0.8.19/crossnote/dependencies/katex/katex.min.css">
      
      
      
      
      
      <style>
      pre{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;padding:1em;margin:.5em 0;overflow:auto;line-height:1.5;tab-size:4;hyphens:none;color:#c5c8c6;background-color:#27292c!important;border:#43484c;border-radius:3px}pre[class*=language-]{padding:1em}code[class*=language-] .token.cdata,code[class*=language-] .token.comment,code[class*=language-] .token.doctype,code[class*=language-] .token.prolog,pre[class*=language-] .token.cdata,pre[class*=language-] .token.comment,pre[class*=language-] .token.doctype,pre[class*=language-] .token.prolog{color:#7c7c7c}code[class*=language-] .token.punctuation,pre[class*=language-] .token.punctuation{color:#96cbfe}code[class*=language-] .namespace,pre[class*=language-] .namespace{opacity:.7}code[class*=language-] .token.constant,pre[class*=language-] .token.constant{color:#9c9}code[class*=language-] .token.boolean,code[class*=language-] .token.function-name,code[class*=language-] .token.number,pre[class*=language-] .token.boolean,pre[class*=language-] .token.function-name,pre[class*=language-] .token.number{color:#ff73fd}code[class*=language-] .token.tag,pre[class*=language-] .token.tag{color:#96cbfe}code[class*=language-] .token.selector,pre[class*=language-] .token.selector{color:#96cbfe}code[class*=language-] .token.attr-name,pre[class*=language-] .token.attr-name{color:#c6c5fe}code[class*=language-] .token.string,pre[class*=language-] .token.string{color:#a8ff60}code[class*=language-] .token.char,pre[class*=language-] .token.char{color:#ff8000}code[class*=language-] .token.entity,pre[class*=language-] .token.entity{color:#ffd2a7}code[class*=language-] .token.url,pre[class*=language-] .token.url{color:#7c7c7c}code[class*=language-] .token.operator,pre[class*=language-] .token.operator{color:#ededed}code[class*=language-] .token.atrule,code[class*=language-] .token.attr-value,code[class*=language-] .token.keyword,pre[class*=language-] .token.atrule,pre[class*=language-] .token.attr-value,pre[class*=language-] .token.keyword{color:#cfcb90}code[class*=language-] .token.function,pre[class*=language-] .token.function{color:#ffd2a7}code[class*=language-] .token.class-name,pre[class*=language-] .token.class-name{color:#ffd2a7}code[class*=language-] .token.variable,pre[class*=language-] .token.variable{color:#c6c5fe}code[class*=language-] .token.important,code[class*=language-] .token.regex,pre[class*=language-] .token.important,pre[class*=language-] .token.regex{color:#e9c062}code[class*=language-] .token.bold,code[class*=language-] .token.important,pre[class*=language-] .token.bold,pre[class*=language-] .token.important{font-weight:700}code[class*=language-] .token.italic,pre[class*=language-] .token.italic{font-style:italic}code[class*=language-] .token.entity,pre[class*=language-] .token.entity{cursor:help}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#c5c8c6;background-color:#1d1f21;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#fff}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#9ba09d}html body strong{color:#fff}html body del{color:#9ba09d}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#ddd;text-decoration:none}html body a:hover{color:#cecece;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#9ba09d;background-color:#303337;border-left:4px solid #43484c}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#43484c;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#fff}html body table td,html body table th{border:1px solid #43484c;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#fff;background-color:#303337;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#43484c;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#fff;border:1px solid #43484c;border-bottom:2px solid #35393c;padding:2px 4px;background-color:#303337;border-radius:3px}@media print{html body{background-color:#1d1f21}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#fff;page-break-after:avoid}html body blockquote{color:#9ba09d}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}html body a{text-decoration:underline}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="introducción">Introducción </h1>
<p>Durante esta primer parte vamos a trabajar con la arquitectura Intel 64</p>
<p>Recuerden siempre tener a mano los <a href="https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html">manuales de Intel</a></p>
<ul>
<li>El volumen 1 describe la arquitectura básica</li>
<li>El volumen 2 es la referencia del conjunto de instrucciones, que también pueden consultar en <a href="https://www.felixcloutier.com/x86/">felixcloutier</a>. Este es el que más les va a servir en las próximas clases.</li>
<li>El volumen 3 es la guía de system programming, la vamos a usar en la segunda parte de la materia.</li>
</ul>
<p>Contamos con el siguiente esquema de registros:</p>
<p><img src="./img/registros%20intel%2064.png" alt="Registros Intel 64"></p>
<p>Recuerden que las versiones de distintos tamaños de un mismo registro (por ejemplo: RAX, EAX, AX, AH, AL) conviven en el mismo circuito físico, es decir, EAX referencia a los 32 bits menos significativos del registro RAX, no se puede modificar el contenido del primero sin alterar el del segundo.</p>
<h1 id="programación-en-assembly-x86">Programación en Assembly x86 </h1>
<p>Vamos a empezar a trabajar con lenguaje ensamblador, observen el siguiente código que corresponde al típico "Hola Mundo", vamos a ver su estructura general:</p>
<pre data-role="codeBlock" data-info="asm" class="language-asm asm"><code>%define SYS_WRITE 1     ;;
%define SYS_EXIT 60     ;; Directivas de preprocesador
%define STDOUT 1        ;;

section .data           ;;--&gt; Directiva de ensamblador          ;;
msg db '¡Hola Mundo!', 10   ;;--&gt; Pseudo-instrucciones          ;; Sección .data
len EQU $ - msg             ;;                                  ;; 

global _start           ;;--&gt; Directivas de ensamblador
section .text           ;;                                      ;;
_start:                                                         ;;
    mov rax, SYS_WRITE                                          ;;
    mov RDI, STDOUT                                             ;;
    mov rsi, msg                                                ;;
    mov rdx, len                                                ;; Sección .text
    syscall                                                     ;;
                                                                ;;
    mov rax, SYS_EXIT                                           ;;
    mov rdi, 0                                                  ;;
    syscall                                                     ;;

</code></pre><p>La idea no es que comprendan lo que hace este código, sino que puedan identificar las partes que lo componen:</p>
<ul>
<li>
<p>Directivas del preprocesador: estas son instrucciones que va a aplicar el preprocesador antes de pasarle el texto al ensamblador, en este caso se están definiendo etiquetas o renombres con ciertos valores. El preprocesador va a tomar estas definiciones y va a reemplazar todas las apariciones de las etiquetas en el resto del texto por sus valores. Por ejemplo, todas las apariciones de <code>SYS_WRITE</code> serán reemplazadas por <code>1</code>.</p>
</li>
<li>
<p>Directivas de ensamblador: estas son instrucciones que le indican al ensamblador cómo interpretar las siguientes líneas de texto y así armar el binario. Por ejemplo, <code>global</code> es una directiva que indica que el siguiente símbolo, en este caso <code>_start</code>,debe poder ser identificado por fuera de este archivo, es decir, una vez ensamblado se debe poder hacer referencia a <code>_start</code> desde otra pieza de código, y un linker debe poder establecer esa conexión.</p>
</li>
<li>
<p>Pseudo-instrucciones: estas son instrucciones que atenderá el ensamblador y no quedarán en el binario resultante que ejecutaría un procesador.</p>
<p>En este caso <code>msg db '¡Hola Mundo!', 10</code> define que debe haber un espacio de memoria identificado con la etiqueta <code>msg</code>, definido de a bytes (db = define bytes), con los siguientes valores <code>'¡Hola Mundo!', 10</code>. Luego, toda aparición de <code>msg</code> en el código será reemplazada por el puntero al comienzo de esa tira de bytes. (el byte 10 se correspone a un salto de línea)</p>
<p>El caso de <code>len EQU $ - msg</code> es similar pero no se almacena nada en memoria, se calcula el valor declarado después de la palabra EQU al momento de ensamblar, y se reemplazan las apariciones de <code>len</code> por el valor resultante. <code>$</code> hace referencia a la posición de memoria en la que se está actualmente, luego, al restarle <code>msg</code>, obtenemos la cantidad de posiciones de memoria (bytes) que hay entre len y msg. Es decir, cada aparición de <code>len</code> se reemplaza por la longitud de lo declarado en <code>msg</code> (en este caso, 13).</p>
</li>
<li>
<p>Sección .data: sección dedicada a definir los datos del programa.</p>
</li>
<li>
<p>Sección .text: sección dedicada a definir el código del programa.</p>
</li>
</ul>
<h2 id="instrucciones">Instrucciones </h2>
<p>Tenemos muchas instrucciones disponibles, cuya sintaxis suele seguir una lógica común:</p>
<ul>
<li>Instruciones sin operandos (o con operandos implícitos). Ej: <code>ret</code> para retornar a la función llamadora.</li>
<li>Instrucciones con un operando: puede ser un registro, una posición de memoria, un inmediato. Ej: <code>jmp .fin</code> salta a la etiqueta <code>.fin</code>, <code>call foo</code> llama a la función foo.</li>
<li>Instrucciones con dos operandos: por lo general el primer operando es el destino (dst), donde se almacenará el resultado de ejecutar la instrucción, y el segundo operando es la fuente (src).
<ul>
<li>Hay que tener en cuenta que para muchas instrucciones el operando destino también es fuente.</li>
<li>Los pares dst-src pueden ser registro-memoria, registro-registro, memoria-registro, registro-inmediato y memoria-inmediato. Nótese como no es posible un par memoria-memoria, las lecturas siempre deben acabar en un registro y las escrituras siempre deben partir de uno o bien de un valor inmediato.</li>
<li>Los inmediatos pueden ser:
<ul>
<li>Decimales: 200</li>
<li>Hexadecimales
<ul>
<li>con el prefijo <code>0x</code>: 0xC8</li>
<li>con el prefijo <code>0h</code>: 0hC8</li>
</ul>
</li>
<li>Octales, con el prefijo <code>0q</code>: 0q310</li>
<li>Binarios:
<ul>
<li>con el sufijo <code>b</code>: 11001000b</li>
<li>con el prefijo <code>0b</code>, que permite guiones: 0b1100_1000</li>
</ul>
</li>
</ul>
</li>
<li>Al trabajar con lecturas y escrituras de memoria hay que tener en cuenta el tamaño del dato que se está leyendo/escribiendo, de lo contrario acabaremos leyendo/escribiendo direcciones de memoria que no corresponden. Para especificar el tamaño de la lectura/escritura, es preciso utilizar el tamaño de registro correcto y añadir el tamaño (BYTE, WORD, DWORD) en el operando de memoria.</li>
<li>Ejemplos:
<ul>
<li>Registro-Registro:
<ul>
<li><code>add rdi, rsi</code></li>
</ul>
</li>
<li>Memoria-Regitro:
<ul>
<li><code>mov [LABEL], rax</code></li>
<li><code>sub r10, [rdx + 4*rax + OFFSET]</code>  (Direccionamiento visto en la teórica: [Base + Indice * Escala + Desplazamiento])</li>
<li>mov ecx, DWORD [rbp - 8]</li>
<li>add BYTE [rdi], sil</li>
</ul>
</li>
<li>Registro-Inmediato:
<ul>
<li><code>sub rsp, 8</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="documentación-de-instrucciones">Documentación de instrucciones </h1>
<p>Tenemos muchas instrucciones disponibles, no vamos a usar todas, pero sí tenemos que ser capaces de navegar la documentación para encontrar la que necesitamos. El volumen 2 del manual de Intel es la referencia del conjunto de instrucciones (disponible en el campus, o en google...), que también pueden consultar en <a href="https://www.felixcloutier.com/x86/">felixcloutier</a>.</p>
<p>¿Con qué se come? Supongamos que tenemos que buscar una instrucción para sumar dos enteros de 64 bits que están en los registros RDI y RAX. Como no conocemos esta instrucción, empezamos consultando el indice del manual donde se encuentran las operaciones con una breve descripción. Vemos que está la operación <code>ADD</code>, en la sección 3-32.</p>
<p><img src="./img/2InstructionSetReferenceAdd.png" alt="Add en el indice del manual"></p>
<p>Vamos a la sección 3-32. Nos encontramos con una tabla y varias secciones:</p>
<ul>
<li>
<p>Description: Una descripción detallada en palabras del comportamiento de la instrucción</p>
</li>
<li>
<p>Operation: Presenta un pseudocódigo que describe el compotamiento de la función</p>
</li>
</ul>
<p><img src="./img/2InstructionSetReferenceAddDescription.png" alt="Add descripcion"></p>
<p>Parece que es lo que buscamos, pero tenemos que asegurarnos de que ambos registros puedan ser de 64 bits. Veamos la tabla:</p>
<p><img src="./img/2InstructionSetReferenceTablaAdd.png" alt="Add tabla"></p>
<p>¿Qué columnas nos interesan?</p>
<ul>
<li>Instruction: describe la sintaxis de uso de la instrucción. Donde vemos <code>rX</code>, significa que el operando puede ser un registro tamaño X bits, <code>immX</code> refiere a un valor inmediato de X bits y <code>mX</code> refiere a que puede ser una dirección de memoria (desreferenciada con corchetes) de tamaño X bits. Más información en la sección 3.1.1.3 "Instruction Column in the Opcode Summary Table".</li>
<li>64-bit Mode: refiere a si es una instrucción válida en una arquitectura de 64 bits, nos interesa que diga "Valid".</li>
<li>Description: una descripción de la instrucción, específica a su uso con esa combinación de operandos.</li>
</ul>
<p>Siguiendo con el ejemplo, nos interesa sumar el valor de dos registros de 64 bits, es decir, tendríamos dos r64 (o un r64 y un r/m64). Volvamos a la tabla para ver si ADD permite esta operación.</p>
<p>Encontramos que las únicas combinaciones de operandos que incluyen registros de 64 bits (r64 y r/m64) son estas dos:</p>
<p><img src="./img/2InstructionSetReferenceTablaAddResaltado64bits.png" alt="Add resaltado en tabla"></p>
<p>Efectivamente, la instrucción nos sirve. La razón por la que aparece en dos filas distintas es porque si dijese <code>ADD r/m64, r/m64</code> estaría contemplando el caso en que ambos operandos son direcciones de memoria a la vez, pero esto en general no está permitido.</p>
<h2 id="pseudo-instrucciones">Pseudo-instrucciones </h2>
<p>Cuando queremos definir datos a mano desde assembler, vamos a necesitar usar pseudo-instrucciones, acá van algunas:</p>
<pre data-role="codeBlock" data-info="asm" class="language-asm asm"><code>db 0x55                                 ; define sólo un byte, 0x55
db 0x55,0x56,0x57                       ; 3 bytes sucesivos
db 'a',0x55                             ; 0x97, 0x55
db 'hello',13,10,'$'                    ; strings como cadenas de bytes, cada caracter es un byte
db `hola\nmundo\n\0`                    ; strings con "C-style \-escapes"
dw 0x1234                               ; define una word, los bytes quedan: 0x34 0x12 (por little-endianness se guarda primero el byte menos significativo)
dd 0x12345678                           ; define una double word, los bytes quedan: 0x78 0x56 0x34 0x12
dq 0x123456789abcdef0                   ; define una quad word,constante de 8 bytes
times 4 db 'ja'                         ; define 4 veces la tira de bytes 'ja', quedando "jajajaja"
</code></pre><p>Recuerden que para acceder a los valores declarados podemos incluir un nombre de etiqueta antes de la directiva de declaración (<code>risa times 4 db 'ja'</code>).</p>
<h2 id="herramientas">Herramientas </h2>
<p>Para ensamblar vamos a usar NASM. Está diseñado para varios sistemas operativos y distintas versiones de ANSI-C, por eso tiene varios formatos de salida. Como trabajaremos con Linux, vamos a utilizar elfx32, elf32 y elf64, que generan formatos de salida ELF32 y ELF64 (Executable and Linkable Format) en los archivos objeto.</p>
<p><img src="./img/ELF.png" alt="Esquema de un archivo ELF"></p>
<p>En la sección <em>Material de cursada</em> del campus virtual van a encontrar links para instalar todas las herramientas que vamos a usar durante el cuatrimestre. Si están trabajando en las compus de los labos ya deberían tener todo instalado.</p>
<h2 id="ejercicio">Ejercicio </h2>
<p>Vamos a probar que todo ande como corresponde.<br>
Creen un archivo que contenga el código del programa HolaMundo que vimos antes. El archivo puede tener el nombre que prefieran, acá lo mencionaremos como <code>HolaMundo.asm</code>.</p>
<p>Para ensamblarlo podemos correr la siguiente línea en la terminal de comandos (estando en la misma carpeta que el código):</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell shell"><code>$ nasm <span class="token parameter variable">-f</span> elf64 <span class="token parameter variable">-g</span> <span class="token parameter variable">-F</span> DWARF HolaMundo.asm
</code></pre><p>Si se fijan en el directorio se les habrá creado un archivo <code>HolaMundo.o</code>, un binario como lo que vimos que <code>GCC</code> genera la clase pasada.</p>
<p>Luego lo linkeamos con:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell shell"><code>$ ld <span class="token parameter variable">-o</span> HolaMundo HolaMundo.o
</code></pre><p>Y finalmente lo ejecutamos con:</p>
<pre data-role="codeBlock" data-info="shell" class="language-shell shell"><code>$ ./HolaMundo
</code></pre><p>De funcionar todo correctamente, los comandos de compilación no deben imprimir ninguna salida, y ejecutar el binario <code>./HolaMundo</code> debe imprimir <code>¡Hola Mundo!</code> en la terminal.</p>
<p>Podríamos crear un makefile para compilar el programa automáticamente ejecutando solo <code>make</code> en la terminal.<br>
Dicho Makefile luciría similar a esto:</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>AS := nasm
ASFLAGS := -f elf64 -F DWARF -g -Wall
LD := ld
LDFLAGS := -g
TARGET := HolaMundo

.PHONY: all clean
all: $(TARGET)
# assembly
HolaMundo.o: HolaMundo.asm
        $(AS) $(ASFLAGS) $&lt;

# linking
$(TARGET): HolaMundo.o
        $(LD) $(LDFLAGS) $&lt; -o $@
clean:
        rm -rf *.o $(TARGET)
</code></pre>
      </div>
      
      
    
    
    
    
    
    
  
    </body></html>